from pykrx import stock
import os
from tqdm import tqdm
import FinanceDataReader as fdr
import time
import pandas as pd

stocks = fdr.StockListing('KOSPI', '2026-01-01')
stock_lst = list(stocks['Code'])

out_dir = "raw_data/"
os.makedirs(out_dir, exist_ok=True)

REMOVED_TICKERS = [
    '450140',
    '010620',
    '102280',
    '006390',
    '091090',
    '005390',
    '010420',
    '093230',
    '049770',
    '012600',
    '168490',
    '034300',
    '115390',
    '282690',
    '003410',
    '030790',
    '001880',
    '068400',
    '380440',
    '155900',
    '015540',
    '010050',
    '008560',
    '000060',
    '096300',
    '280360',
    '153360',
    '138250',
    '007630',
    '015350',
    '101060',
    '172580',
    '144620',
    '033660',
    '102260',
    '152330',
    '004200',
    '027970',
    '099350',
    '099340',
    '055550',
    '083370',
    '103130',
    '083380',
    '159650',
    '027390',
    '011160',
    '079440',
    '079660',
    '002250',
    '140890',
    '000030',
    '004130',
    '002000',
    '192530',
    '005980',
    '008000',
    '900050',
    '005620',
    '083620',
    '021960',
    '002550',
    '004740',
    '083610',
    '083600',
    '083590',
    '083580',
    '083570',
    '083390',
    '083360',
    '083350',
    '091000',
    '090990',
    '090980',
    '090970',
    '110570',
    '213500',
    '117930',
    '006800',
    '068870',
    '011930',
    '104120',
    '011720',
    '007310'
]
stock_lst = stock_lst + REMOVED_TICKERS

print(len(stock_lst))
for a_stock in tqdm(stock_lst):
    df = stock.get_market_ohlcv("20060101", "20251231", a_stock)
    time.sleep(0.1)
    df.index = pd.to_datetime(df.index)
    df.to_csv(out_dir + f"{a_stock}.csv", encoding="utf-8-sig")
